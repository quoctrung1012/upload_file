<div class="container">
  <div class="header">
    <h1>üé¨ Video Manager</h1>
    <p>Upload, manage v√† stream video c·ªßa b·∫°n m·ªôt c√°ch d·ªÖ d√†ng</p>
  </div>

  <div class="content">
    <div class="upload-section">
      <div class="section-header">
        <h2 class="section-title">
          <span>üì§</span>
          T·∫£i l√™n Video
        </h2>

        <div class="upload-controls">
          <button class="btn btn-toggle" (click)="toggleUploadMethod()">
            {{ useAsyncUpload ? '‚ö° Async Mode' : 'üîÑ Sync Mode' }}
          </button>
        </div>
      </div>

      <div class="upload-area"
           (click)="fileInput.click()"
           (dragover)="onDragOver($event)"
           (dragleave)="onDragLeave($event)"
           (drop)="onDrop($event)">
        <input #fileInput type="file" class="file-input"
               multiple accept="video/*" (change)="onFileSelected($event)">
        <div class="upload-icon">‚òÅÔ∏è</div>
        <div class="upload-text">Nh·∫•p ƒë·ªÉ ch·ªçn video ho·∫∑c k√©o th·∫£ file v√†o ƒë√¢y</div>
        <div class="upload-hint">
          H·ªó tr·ª£: MP4, AVI, MOV, WMV, FLV, WEBM, MKV
          <br>
          <small>Mode: {{ useAsyncUpload ? 'Async Upload (Nhanh h∆°n)' : 'Sync Upload (·ªîn ƒë·ªãnh h∆°n)' }}</small>
        </div>
      </div>

      <div class="upload-progress" *ngIf="getProgressKeys().length > 0">
        <div class="progress-item" *ngFor="let filename of getProgressKeys()"
             [class.error]="isUploadError(filename)"
             [class.success]="progressMap[filename] === 100 && !isUploadError(filename)">
          <div class="progress-header">
            <div class="progress-filename">{{filename}}</div>
            <div class="progress-status">
              <div class="progress-percentage" *ngIf="!isUploadError(filename)">
                {{progressMap[filename]}}%
              </div>
              <div class="progress-percentage error" *ngIf="isUploadError(filename)">
                ‚ùå Error
              </div>
              <div class="progress-percentage success" *ngIf="progressMap[filename] === 100 && !isUploadError(filename)">
                ‚úÖ Complete
              </div>
            </div>
          </div>
          <div class="progress-bar" *ngIf="!isUploadError(filename)">
            <div class="progress-fill"
                 [style.width.%]="progressMap[filename]"
                 [class.complete]="progressMap[filename] === 100"></div>
          </div>
          <div class="error-message" *ngIf="isUploadError(filename)">
            Upload failed. File will be cleaned up automatically.
          </div>
        </div>
      </div>
    </div>

    <div class="videos-section">
      <h2 class="section-title">
        <span>üì∫</span>
        Danh s√°ch Video ({{videos.length}})
      </h2>

      <div class="videos-container">
        <div class="loading" *ngIf="loading">
          <div class="spinner"></div>
          <p>ƒêang t·∫£i danh s√°ch video...</p>
        </div>

        <div class="empty-state" *ngIf="!loading && videos.length === 0 && !error">
          <div class="empty-icon">üìπ</div>
          <div class="empty-text">Ch∆∞a c√≥ video n√†o</div>
          <div class="empty-hint">H√£y upload video ƒë·∫ßu ti√™n c·ªßa b·∫°n!</div>
        </div>

        <div class="empty-state error-state" *ngIf="error">
          <div class="empty-icon">‚ùå</div>
          <div class="empty-text">C√≥ l·ªói x·∫£y ra</div>
          <div class="empty-hint">{{error}}</div>
          <button class="btn btn-retry" (click)="fetchVideos()">üîÑ Th·ª≠ l·∫°i</button>
        </div>

        <div class="videos-grid" *ngIf="!loading && videos.length > 0">
          <div class="video-card" *ngFor="let video of videos; trackBy: trackByVideoId">
            <div class="video-thumbnail">
              <video class="video-player" controls preload="metadata">
                <source [src]="getVideoUrl(video)" [type]="video.type">
                Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ph√°t video.
              </video>
            </div>

            <div class="video-info">
              <h3 class="video-title" [title]="video.name">{{video.name}}</h3>

              <div class="video-meta">
                <div class="meta-row">
                  <span class="video-type">{{video.type}}</span>
                  <span class="video-size">{{formatFileSize(video.size)}}</span>
                </div>
                <div class="meta-row">
                  <span class="video-date">{{formatDate(video.createdAt)}}</span>
                  <span class="video-storage" [class.database]="video.path === '(db)'">
                    {{ video.path === '(db)' ? 'üíæ Database' : 'üìÅ File System' }}
                  </span>
                </div>
              </div>

              <div class="video-actions">
                <button class="btn btn-info" (click)="showVideoInfo(video)">
                  ‚ÑπÔ∏è Info
                </button>
                <button class="btn btn-delete" (click)="deleteVideo(video.id)">
                  üóëÔ∏è X√≥a
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Video Info Modal (optional) -->
  <div class="modal" *ngIf="selectedVideoInfo" (click)="closeVideoInfo()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>üìã Th√¥ng tin Video</h3>
        <button class="modal-close" (click)="closeVideoInfo()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="info-row">
          <strong>ID:</strong> {{selectedVideoInfo.id}}
        </div>
        <div class="info-row">
          <strong>T√™n:</strong> {{selectedVideoInfo.name}}
        </div>
        <div class="info-row">
          <strong>Lo·∫°i:</strong> {{selectedVideoInfo.type}}
        </div>
        <div class="info-row">
          <strong>K√≠ch th∆∞·ªõc:</strong> {{formatFileSize(selectedVideoInfo.size)}}
        </div>
        <div class="info-row">
          <strong>Ng√†y t·∫°o:</strong> {{formatDate(selectedVideoInfo.createdAt)}}
        </div>
        <div class="info-row">
          <strong>L∆∞u tr·ªØ:</strong>
          <span [class.database]="selectedVideoInfo.path === '(db)'">
            {{ selectedVideoInfo.path === '(db)' ? 'Database' : selectedVideoInfo.path }}
          </span>
        </div>
      </div>
    </div>
  </div>
</div>
